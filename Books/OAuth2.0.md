**OAuth 2.0**
=============

>OAuth 通过将客户端和资源拥有者的角色进行分离来解决这些问题。在 OAuth 中,客户端(通常不是资源拥有者,而是代表资源拥有者来操作)提出请求来访问由资源拥有者控制并由资源服务器托管 的资源,然后得到与资源拥有者不同的一套私有证书。

>客户端并不是直接使用资源拥有者的私有证书来访问受保护资源,而是得到一个访问令牌——一个代表某一特定作用域、持续时间和其它属性的字符串{译者注:非常重要的一个概念,英文叫 **access token**}。

>访问令牌由授权服务器在资源拥有者的授意下分发给第三方客户端。客户端使用访问令牌来 访问由资源服务器托管的受保护资源。

##1.概述

抽象流程协议的总体架构,它包含下列步骤:

>1. 客户端从资源拥有者那里请求授权。授权请求能够直接发送给资源拥有者,或者间接地通过授权服务器这样的中介,而后者更为可取。

>2. 客户端收到一个访问许可 __(第二部分)__,它代表由资源服务器提供的授权。>3. 客户端使用它自己的私有证书到授权服务器上验证,并出示访问许可,来请求一个访问令牌。>4. 授权服务器验证客户端私有证书和访问许可的有效性,如果验证通过则分发一个访问令牌。>5. 客户端通过出示访问令牌向资源服务器请求受保护资源。>6. 资源服务器验证访问令牌的有效性,如果验证通过则响应这个资源请求。


##2.访问许可

访问许可代表资源拥有者(大部分情况下就是用户)提供的授权。访问许可的类型取决于客户端使用的获取方式和授权服务器所支持的方式。####1.授权码
授权码获取流程包含下列步骤:
>1. 客户端通过将终端用户的 user-agent 引导到授权服务器的终端用户授权 endpoint 来发起这个流 程。客户端传入标识符、请求作用域、本地状态,和一个重定向 URI(在访问被许可或被拒绝后授权 服务器会重新将 user-agent 引导回这个 URI)。
>2. 授权服务器验证终端用户的身份(通过 user-agent),并且确定终端用户是许可还是拒绝了客户 端的访问请求。>3. 如果访问被许可,授权服务器会使用重定向 URI 将 user-agent 引导回客户端。授权服务器传回一个授权码给客户端,用于进一步获取访问令牌。
一旦客户端获得了授权码,它会到授权服务器上去做验证(使用客户端私有证书)并出示授权码(访问许可),以借此请求一个访问令牌。
__在客户端无法维护它自己的私有证书的情况下(如原生程序或用某种 user-agent 脚本实现的程序), 授权服务器在(3)步直接给客户端分发一个访问令牌,而不再分发一个授权码。__

####2.资源拥有者密码证书

客户端直接从资源拥有者请求授权。当资源拥有者是一个终端用户时,客户端通常的做法 是提示终端用户输入用户名和密码。

####3.客户端私有证书

当授权作用域限制在客户端所控制的受保护资源或之前与授权服务器约定好的受保护资源时,客户端本身的私有证书可被用作访问许可。客户端私有证书用作访问许可的典型例子是,当客户端代表它自己执行操作时(客户端同时也是资源拥有者)。

####4.刷新令牌

刷新令牌流程包含下列步骤:
>1. 客户端通过使用它自己的私有证书在授权服务器上验证,并出示一个访问许可。>2. 授权服务器验证客户端私有证书和访问许可的有效性,如果通过则分发一个访问令牌和刷新令牌。>3. 客户端通过出示访问令牌向资源服务器请求受保护资源。

>4. 资源服务器验证访问令牌的有效性,如果通过,则相应这个请求。>5. 步骤(3)(4)不停重复,直到访问令牌过期。如果客户端不知道访问令牌过期,它会再请求一次受保护资源。否则,跳到步骤(7)。>6. 因为访问令牌是无效的(过期了),资源服务器返回一个无效令牌错误。>7. 客户端通过使用它的私有证书在授权服务器上验证并出示刷新令牌(用作访问许可),来请求一个新的访问令牌。>8. 授权服务器验证客户端私有证书的有效性,如果通过则分发一个新的访问令牌(也可能还有一个刷新令牌)。
####5.断言

>断言在 OAuth 和其它信任框架之间架起一座桥梁。它们允许客户端利用现成的信任关系来获取访问 令牌。一个断言所代表的访问许可取决于断言类型、断言内容,以及断言被分发的方式,而这些内容 不在本规范的规定范围之内。